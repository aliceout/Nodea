[
  {
    "name": "users",
    "type": "auth",
    "fields": [
      { "name": "username", "type": "text", "required": true },
      { "name": "role", "type": "select", "values": ["admin", "user"] },
      { "name": "email", "type": "email", "required": true, "system": true },
      { "name": "encrypted_key", "type": "text", "required": true },
      { "name": "encryption_salt", "type": "text", "required": true },
      { "name": "modules", "type": "text" },
      { "name": "verified", "type": "bool", "system": true },
      { "name": "id", "type": "text", "primaryKey": true, "required": true, "system": true },
      { "name": "password", "type": "password", "required": true, "system": true },
      { "name": "tokenKey", "type": "text", "required": true, "system": true },
      { "name": "emailVisibility", "type": "bool", "system": true },
      { "name": "created", "type": "autodate", "onCreate": true },
      { "name": "updated", "type": "autodate", "onCreate": true, "onUpdate": true }
    ],
    "indexes": [
      "CREATE UNIQUE INDEX idx_tokenKey_users ON users(tokenKey)",
      "CREATE UNIQUE INDEX idx_email_users ON users(email) WHERE email != ''"
    ],
    "listRule": "@request.auth.role = 'admin' || @request.auth.id = id",
    "viewRule": "@request.auth.role = 'admin' || @request.auth.id = id",
    "createRule": "",
    "updateRule": "@request.auth.role = 'admin' || @request.auth.id = id",
    "deleteRule": "@request.auth.role = 'admin' || @request.auth.id = id"
  },
  {
    "name": "mood_entries",
    "type": "base",
    "fields": [
      { "name": "module_user_id", "type": "text", "required": true },
      { "name": "payload", "type": "text", "required": true },
      { "name": "cipher_iv", "type": "text", "required": true },
      { "name": "guard", "type": "text", "required": true, "hidden": true },
      { "name": "created", "type": "autodate", "onCreate": true },
      { "name": "updated", "type": "autodate", "onCreate": true, "onUpdate": true },
      { "name": "id", "type": "text", "primaryKey": true, "required": true, "system": true }
    ],
    "indexes": [
      "CREATE INDEX idx_mood_entries_module_user_id ON mood_entries(module_user_id)"
    ],
    "listRule": "@request.query.sid = module_user_id",
    "viewRule": "@request.query.sid = module_user_id",
    "createRule": "@request.auth.id != ''",
    "updateRule": "@request.query.sid = module_user_id && @request.query.d = guard",
    "deleteRule": "@request.query.sid = module_user_id && @request.query.d = guard"
  }
]
